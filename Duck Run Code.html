<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duck Avoidance Game</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { background: lightblue; display: block; margin: auto; }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="1260" height="630"></canvas>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        // Music setup with external URL
        const backgroundMusic = new Audio('https://dl.sndup.net/tz582/Sparta%20Remix%20Extended%20-%20Instrumental%20version.mp3'); // Replace with actual link
        backgroundMusic.loop = true;   // Loop the music
        backgroundMusic.volume = 0.5;  // Set volume (0.0 to 1.0)

        // Constants
        const SCREEN_WIDTH = 1260;
        const SCREEN_HEIGHT = 630;
        const DUCK_WIDTH = 50;
        const DUCK_HEIGHT = 50;
        const OBJECT_WIDTH = 50;
        const OBJECT_HEIGHT = 50;
        const GRAVITY = 1;
        const JUMP_STRENGTH = 25;
        const ACCELERATION = 1;
        const MAX_SPEED = 20;
        const FRICTION = 0.3;
        const MAX_FALL_SPEED = 20;

        let OBJECT_FALL_SPEED = 5;
        let SPEED_MULTIPLIER = 1;
        let spawnProbability = 0.03;

        const WHITE = "white";
        const BLACK = "black";
        const BLUE = "yellow";

        let duck, objects, score, gameOver, keysPressed;

        function resetGame() {
            duck = {
                x: SCREEN_WIDTH / 2,
                y: SCREEN_HEIGHT - DUCK_HEIGHT - 10,
                velocityX: 0,
                isJumping: false,
                jumpVelocity: 0,
            };

            objects = [];
            score = 0;
            gameOver = false;
            keysPressed = {};

            SPEED_MULTIPLIER = 1;
            OBJECT_FALL_SPEED = 5;
            spawnProbability = 0.03;

            backgroundMusic.currentTime = 0; // Reset music to the beginning
            backgroundMusic.play(); // Play the music again
        }

        document.addEventListener("keydown", (event) => {
            keysPressed[event.key] = true;
            if (event.key === " " && !duck.isJumping) {
                duck.isJumping = true;
                duck.jumpVelocity = JUMP_STRENGTH;
            }
        });

        document.addEventListener("keyup", (event) => {
            keysPressed[event.key] = false;
        });

        function addFallingObject() {
            const objectX = Math.random() * (SCREEN_WIDTH - OBJECT_WIDTH);
            const isSpecial = Math.random() < 0.1;
            objects.push({ 
                x: objectX, 
                y: 0, 
                width: OBJECT_WIDTH, 
                height: OBJECT_HEIGHT,
                isSpecial: isSpecial
            });
        }

        function increaseSpeed() {
            SPEED_MULTIPLIER += 0.005;
            OBJECT_FALL_SPEED = Math.min(5 * SPEED_MULTIPLIER, MAX_FALL_SPEED);
        }

        function adjustSpawnRate() {
            spawnProbability = Math.min(0.03 + SPEED_MULTIPLIER * 0.01, 0.1);
        }

        function update() {
            if (keysPressed["ArrowLeft"]) {
                duck.velocityX -= ACCELERATION;
            }
            if (keysPressed["ArrowRight"]) {
                duck.velocityX += ACCELERATION;
            }

            if (duck.velocityX > MAX_SPEED) duck.velocityX = MAX_SPEED;
            if (duck.velocityX < -MAX_SPEED) duck.velocityX = -MAX_SPEED;

            if (!keysPressed["ArrowLeft"] && !keysPressed["ArrowRight"]) {
                duck.velocityX *= 1 - FRICTION;
            }

            duck.x += duck.velocityX;
            duck.x = Math.max(0, Math.min(SCREEN_WIDTH - DUCK_WIDTH, duck.x));

            if (duck.isJumping) {
                duck.y -= duck.jumpVelocity;
                duck.jumpVelocity -= GRAVITY;
                if (duck.y >= SCREEN_HEIGHT - DUCK_HEIGHT - 10) {
                    duck.y = SCREEN_HEIGHT - DUCK_HEIGHT - 10;
                    duck.isJumping = false;
                }
            }

            for (let i = objects.length - 1; i >= 0; i--) {
                const obj = objects[i];
                obj.y += OBJECT_FALL_SPEED;

                if (obj.y > SCREEN_HEIGHT) {
                    objects.splice(i, 1);
                    score++;
                }

                if (duck.x < obj.x + obj.width &&
                    duck.x + DUCK_WIDTH > obj.x &&
                    duck.y < obj.y + obj.height &&
                    duck.y + DUCK_HEIGHT > obj.y) {
                    
                    if (obj.isSpecial) {
                        score += 10;
                        objects.splice(i, 1);
                    } else {
                        gameOver = true;
                    }
                }
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = BLUE;
            ctx.fillRect(duck.x, duck.y, DUCK_WIDTH, DUCK_HEIGHT);

            objects.forEach((obj) => {
                ctx.fillStyle = obj.isSpecial ? 'green' : BLACK;
                ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
            });

            ctx.fillStyle = BLACK;
            ctx.font = "20px Arial";
            ctx.fillText("Score: " + score, 10, 20);
        }

        function gameLoop() {
            if (!gameOver) {
                update();
                draw();
                if (Math.random() < spawnProbability) addFallingObject();
                increaseSpeed();
                adjustSpawnRate();
                requestAnimationFrame(gameLoop);
            } else {
                alert("Game Over! Your score: " + score);
                resetGame(); // Reset the game without reloading
                requestAnimationFrame(gameLoop); // Restart the game loop
            }
        }

        resetGame(); // Initialize game variables and music
        gameLoop(); // Start the game loop
    </script>
</body>
</html>
